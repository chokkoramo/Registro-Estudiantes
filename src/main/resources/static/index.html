<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Sistema Académico</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
        }
        input, button {
            margin: 5px;
            padding: 6px;
        }
        table {
            margin-top: 20px;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
            padding: 8px;
        }
        th {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>

<h1>Sistema Académico</h1>

<h2>Registrar Estudiante</h2>
<input type="text" id="nombre" placeholder="Nombre">
<input type="text" id="programa" placeholder="Programa">
<button onclick="registrar()">Registrar</button>

<h2>Asignar Nota</h2>
<input type="number" id="idNota" placeholder="ID estudiante">
<input type="number" step="0.1" id="nota" placeholder="Nota">
<button onclick="asignarNota()">Asignar Nota</button>

<h2>Acciones</h2>
<button onclick="listar()">Listar Todos</button>
<button onclick="ranking()">Ver Ranking</button>

<h2>Resultados</h2>
<div id="resultado"></div>

<script>

    const API = "/estudiantes";

    function registrar() {
        fetch(API, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                nombre: document.getElementById("nombre").value,
                programa: document.getElementById("programa").value
            })
        })
            .then(res => res.json())
            .then(data => {
                mostrarMensaje("Estudiante registrado con ID: " + data.id);
                listar();
            });
    }

    function asignarNota() {
        const id = document.getElementById("idNota").value;
        const nota = parseFloat(document.getElementById("nota").value);

        fetch(`${API}/${id}/notas`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ nota: nota })
        })
            .then(res => res.text())
            .then(data => {
                mostrarMensaje(data);
                listar();
            });
    }

    function listar() {
        fetch(API)
            .then(res => res.json())
            .then(data => mostrarTabla(data));
    }

    function ranking() {
        fetch(`${API}/ranking`)
            .then(res => res.json())
            .then(data => mostrarTabla(data));
    }

    function mostrarTabla(estudiantes) {
        let html = "<table>";
        html += `
        <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Programa</th>
            <th>Promedio</th>
            <th>Estado</th>
        </tr>
    `;

        estudiantes.forEach(e => {
            html += `
            <tr>
                <td>${e.id}</td>
                <td>${e.nombre}</td>
                <td>${e.programa}</td>
                <td>${e.promedio ?? e.promedio === 0 ? e.promedio.toFixed(2) : "0.00"}</td>
                <td>${e.aprobado ? "APROBADO" : "REPROBADO"}</td>
            </tr>
        `;
        });

        html += "</table>";

        document.getElementById("resultado").innerHTML = html;
    }

    function mostrarMensaje(msg){
        document.getElementById("resultado").innerHTML = "<p><b>" + msg + "</b></p>";
    }

</script>

</body>
</html>